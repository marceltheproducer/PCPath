<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PCPath â€” Path Converter</title>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    --font-color: #e0e0e0;
    --bg-primary: #1a1a1a;
    --bg-secondary: #111;
    --bg-tertiary: #2a2a2a;
    --border-color: #333;
    --border-hover: #555;
    --border-dark: #444;
    --text-muted: #aaa;
    --text-dim: #555;
    --transition-fast: 0.15s;
    --mono-font: "SF Mono", "Fira Code", "Cascadia Code", Consolas, monospace;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background: #0f0f0f;
    color: var(--font-color);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 2rem 1rem;
  }

  h1 {
    font-size: 1.8rem;
    font-weight: 700;
    margin-bottom: 0.25rem;
    color: var(--font-color);
  }

  .version {
    font-size: 0.7rem;
    font-weight: 400;
    opacity: 0.35;
    vertical-align: middle;
  }

  .subtitle {
    color: var(--font-color);
    opacity: 0.55;
    font-size: 0.9rem;
    margin-bottom: 2rem;
  }

  .container {
    width: 100%;
    max-width: 640px;
  }

  .path-box {
    position: relative;
    margin-bottom: 1.25rem;
  }

  .path-box label {
    display: block;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--font-color);
    opacity: 0.55;
    margin-bottom: 0.4rem;
  }

  .path-box textarea {
    width: 100%;
    min-height: 80px;
    padding: 0.75rem 3.5rem 0.75rem 0.75rem;
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    color: var(--font-color);
    font-family: var(--mono-font);
    font-size: 0.9rem;
    line-height: 1.5;
    resize: vertical;
    transition: border-color var(--transition-fast);
  }

  .path-box textarea:focus {
    outline: none;
    border-color: var(--border-hover);
  }

  .path-box textarea::placeholder { color: var(--text-dim); }

  .copy-btn {
    position: absolute;
    right: 8px;
    bottom: 12px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-dark);
    border-radius: 6px;
    color: var(--text-muted);
    font-size: 0.75rem;
    padding: 0.3rem 0.6rem;
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .copy-btn:hover { background: var(--border-color); color: #fff; border-color: #666; }
  .copy-btn.copied { color: #4ade80; border-color: #4ade80; }

  .arrow {
    text-align: center;
    font-size: 1.5rem;
    color: var(--font-color);
    opacity: 0.35;
    margin-bottom: 1.25rem;
    user-select: none;
  }

  .badge {
    display: inline-block;
    font-size: 0.7rem;
    font-weight: 600;
    padding: 0.15rem 0.5rem;
    border-radius: 4px;
    margin-left: 0.5rem;
    vertical-align: middle;
  }

  .badge.mac { background: #1d3557; color: #a8dadc; }
  .badge.pc  { background: #3d1f00; color: #f4a261; }
  .badge.unknown { background: #222; color: #666; }

  /* Mappings editor */
  .mappings-toggle {
    background: none;
    border: none;
    color: var(--font-color);
    opacity: 0.45;
    font-size: 0.8rem;
    cursor: pointer;
    margin-top: 1.5rem;
    padding: 0.25rem 0;
    display: flex;
    align-items: center;
    gap: 0.4rem;
    transition: color 0.15s;
  }

  .mappings-toggle:hover { opacity: 0.7; }
  .mappings-toggle .chevron { transition: transform 0.2s; }
  .mappings-toggle.open .chevron { transform: rotate(90deg); }

  .mappings-panel {
    display: none;
    margin-top: 0.75rem;
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 1rem;
  }

  .mappings-panel.open { display: block; }

  .mappings-panel .mapping-row {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }

  .mappings-panel input {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    color: var(--font-color);
    font-family: var(--mono-font);
    font-size: 0.85rem;
    padding: 0.35rem 0.5rem;
  }

  .mappings-panel input.vol-input { flex: 1; }
  .mappings-panel input.letter-input { width: 3rem; text-align: center; text-transform: uppercase; }

  .mappings-panel .eq { color: var(--text-dim); font-family: monospace; }

  .mapping-remove {
    background: none;
    border: none;
    color: var(--text-dim);
    font-size: 1rem;
    cursor: pointer;
    padding: 0 0.25rem;
    line-height: 1;
    transition: color var(--transition-fast);
  }

  .mapping-remove:hover { color: #e74c3c; }

  .mapping-actions {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.75rem;
  }

  .mapping-actions button {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-dark);
    border-radius: 6px;
    color: var(--text-muted);
    font-size: 0.75rem;
    padding: 0.35rem 0.7rem;
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .mapping-actions button:hover { background: var(--border-color); color: #fff; }

  .hint {
    color: var(--text-dim);
    font-size: 0.75rem;
    margin-top: 0.5rem;
  }

  /* Theme picker */
  .theme-picker {
    position: fixed;
    top: 1rem;
    left: 1rem;
    z-index: 100;
  }

  .theme-btn {
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 8px;
    color: inherit;
    font-size: 0.75rem;
    padding: 0.35rem 0.65rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.4rem;
    transition: all var(--transition-fast);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }

  .theme-btn:hover { background: rgba(255,255,255,0.14); }

  .theme-swatch {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 1px solid rgba(255,255,255,0.25);
    flex-shrink: 0;
  }

  .theme-dropdown {
    display: none;
    position: absolute;
    top: calc(100% + 6px);
    left: 0;
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 0.4rem;
    min-width: 180px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.5);
  }

  .theme-dropdown.open { display: block; }

  .theme-option {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.4rem 0.5rem;
    border-radius: 5px;
    cursor: pointer;
    font-size: 0.8rem;
    color: #ccc;
    border: none;
    background: none;
    width: 100%;
    text-align: left;
    transition: background var(--transition-fast);
  }

  .theme-option:hover { background: rgba(255,255,255,0.08); }

  .theme-option .swatch {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    border: 1px solid rgba(255,255,255,0.2);
    flex-shrink: 0;
  }

  .theme-hex-row {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.4rem 0.5rem;
    border-top: 1px solid var(--border-color);
    margin-top: 0.25rem;
    padding-top: 0.5rem;
  }

  .theme-hex-row label {
    font-size: 0.75rem;
    color: #888;
    white-space: nowrap;
    min-width: 38px;
  }

  .theme-hex-input {
    flex: 1;
    min-width: 50px;
    max-width: 90px;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    color: var(--font-color);
    font-family: var(--mono-font);
    font-size: 0.8rem;
    padding: 0.3rem 0.4rem;
    transition: border-color var(--transition-fast);
  }

  .theme-hex-input:focus { outline: none; border-color: var(--border-hover); }
  .theme-hex-input.invalid { border-color: #e74c3c; animation: shake 0.3s; }

  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-4px); }
    75% { transform: translateX(4px); }
  }

  .theme-hex-apply {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-dark);
    border-radius: 4px;
    color: var(--text-muted);
    font-size: 0.7rem;
    padding: 0.3rem 0.5rem;
    cursor: pointer;
    white-space: nowrap;
    transition: all var(--transition-fast);
  }

  .theme-hex-apply:hover { background: var(--border-color); color: #fff; }

  /* Light theme adjustments */
  body.light-theme {
    --bg-primary: rgba(0,0,0,0.05);
    --bg-secondary: #fff;
    --bg-tertiary: rgba(0,0,0,0.06);
    --border-color: rgba(0,0,0,0.15);
    --border-hover: rgba(0,0,0,0.3);
    --border-dark: rgba(0,0,0,0.15);
    --text-muted: rgba(0,0,0,0.6);
    --text-dim: rgba(0,0,0,0.3);
  }

  body.light-theme .theme-dropdown { background: #f5f5f5; box-shadow: 0 8px 24px rgba(0,0,0,0.15); }
  body.light-theme .theme-option:hover { background: rgba(0,0,0,0.06); }
  body.light-theme .theme-swatch,
  body.light-theme .theme-option .swatch { border-color: rgba(0,0,0,0.2); }
  body.light-theme .theme-hex-row { border-color: rgba(0,0,0,0.1); }
</style>
</head>
<body>

<!-- Theme Picker -->
<div class="theme-picker">
  <button class="theme-btn" id="theme-toggle">
    <span class="theme-swatch" id="theme-swatch"></span>
    <span id="theme-label">Theme</span>
  </button>
  <div class="theme-dropdown" id="theme-dropdown">
    <button class="theme-option" data-color="#0f0f0f" data-font="#e0e0e0" data-light="false">
      <span class="swatch" style="background:#0f0f0f"></span> Dark (Default)
    </button>
    <button class="theme-option" data-color="#ffffff" data-font="#222222" data-light="true">
      <span class="swatch" style="background:#ffffff"></span> White
    </button>
    <button class="theme-option" data-color="#ffc0cb" data-font="#4a2030" data-light="true">
      <span class="swatch" style="background:#ffc0cb"></span> Pink
    </button>
    <button class="theme-option" data-color="#a8e6cf" data-font="#1a3a2a" data-light="true">
      <span class="swatch" style="background:#a8e6cf"></span> Mint Green
    </button>
    <div class="theme-hex-row">
      <label>BG #</label>
      <input class="theme-hex-input" id="hex-input" placeholder="ffffff" maxlength="7" spellcheck="false">
      <button class="theme-hex-apply" id="hex-apply">Apply</button>
    </div>
    <div class="theme-hex-row">
      <label>Font #</label>
      <input class="theme-hex-input" id="font-hex-input" placeholder="000000" maxlength="7" spellcheck="false">
      <button class="theme-hex-apply" id="font-hex-apply">Apply</button>
      <button class="theme-hex-apply" id="font-hex-auto" title="Reset to auto-detected font color">Auto</button>
    </div>
  </div>
</div>

<h1>PCPath <span class="version">v1.1.1</span></h1>
<p class="subtitle">Paste a path. Get the other format.</p>

<div class="container">
  <div class="path-box">
    <label>Input <span id="input-badge" class="badge unknown">paste a path</span></label>
    <textarea id="input" placeholder="K:\Projects\Assets\logo.psd&#10;/Volumes/CONTENT/Projects/Assets/logo.psd" spellcheck="false"></textarea>
  </div>

  <div class="arrow">&#8595;</div>

  <div class="path-box">
    <label>Output <span id="output-badge" class="badge unknown"></span></label>
    <textarea id="output" readonly placeholder="Converted path appears here" spellcheck="false"></textarea>
    <button class="copy-btn" id="copy-btn" title="Copy to clipboard">Copy</button>
  </div>

  <button class="mappings-toggle" id="mappings-toggle">
    <span class="chevron">&#9654;</span> Drive mappings
  </button>

  <div class="mappings-panel" id="mappings-panel">
    <div id="mappings-list"></div>
    <div class="mapping-actions">
      <button id="add-mapping">+ Add mapping</button>
      <button id="reset-mappings">Reset to defaults</button>
    </div>
    <p class="hint">Mappings are saved in your browser's local storage.</p>
  </div>
</div>

<script>
const DEFAULT_MAPPINGS = [
  { vol: "CONTENT", letter: "K" },
  { vol: "GFX", letter: "G" },
  { vol: "EDIT", letter: "E" },
  { vol: "THE_NETWORK", letter: "N" },
];

const STORAGE_KEY = "pcpath_mappings";

function loadMappings() {
  try {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) return JSON.parse(saved);
  } catch {}
  return DEFAULT_MAPPINGS.map(m => ({ ...m }));
}

function saveMappings(mappings) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(mappings));
}

let mappings = loadMappings();

// --- Detection ---

function detectType(path) {
  const trimmed = path.trim();
  if (!trimmed) return "unknown";
  if (/^[A-Za-z]:[\\\/]/.test(trimmed) || /^[A-Za-z]:$/.test(trimmed)) return "pc";
  if (trimmed.startsWith("/Volumes/")) return "mac";
  if (trimmed.includes("\\")) return "pc";
  if (trimmed.startsWith("/")) return "mac";
  return "unknown";
}

// --- Mac to PC ---

function macToPC(macPath) {
  const lowerPath = macPath.toLowerCase();

  for (const { vol, letter } of mappings) {
    const prefix = `/Volumes/${vol}/`.toLowerCase();
    const exact = `/Volumes/${vol}`.toLowerCase();

    if (lowerPath.startsWith(prefix)) {
      const remainder = macPath.slice(prefix.length);
      return `${letter.toUpperCase()}:\\${remainder}`.replace(/\//g, "\\");
    }
    if (lowerPath === exact) {
      return `${letter.toUpperCase()}:\\`;
    }
  }

  // No mapping found
  if (macPath.startsWith("/Volumes/")) {
    const afterVolumes = macPath.slice(9); // "/Volumes/".length
    const slashIdx = afterVolumes.indexOf("/");
    const volName = slashIdx === -1 ? afterVolumes : afterVolumes.slice(0, slashIdx);
    const remainder = slashIdx === -1 ? "" : afterVolumes.slice(slashIdx + 1);
    return remainder ? `?(${volName}):\\${remainder}`.replace(/\//g, "\\") : `?(${volName}):\\`;
  }

  return macPath.replace(/\//g, "\\");
}

// --- PC to Mac ---

function pcToMac(pcPath) {
  const normalized = pcPath.replace(/\\/g, "/");
  const match = normalized.match(/^([A-Za-z]):(.*)/);
  if (!match) return normalized;

  const drive = match[1].toUpperCase();
  const remainder = match[2].replace(/^\//, ""); // Remove leading slash if present

  // Find matching volume
  const mapping = mappings.find(({ letter }) => letter.toUpperCase() === drive);
  if (mapping) {
    return remainder ? `/Volumes/${mapping.vol}/${remainder}` : `/Volumes/${mapping.vol}`;
  }

  // Unknown drive letter
  return remainder ? `/Volumes/?(${drive})/${remainder}` : `/Volumes/?(${drive})`;
}

// --- Convert ---

function convert(input) {
  return input.split("\n").map(raw => {
    const line = raw.trim();
    if (!line) return "";

    const type = detectType(line);
    return type === "pc" ? pcToMac(line) :
           type === "mac" ? macToPC(line) :
           line;
  }).join("\n");
}

// --- UI ---

const inputEl = document.getElementById("input");
const outputEl = document.getElementById("output");
const inputBadge = document.getElementById("input-badge");
const outputBadge = document.getElementById("output-badge");
const copyBtn = document.getElementById("copy-btn");
const toggleBtn = document.getElementById("mappings-toggle");
const panel = document.getElementById("mappings-panel");
const listEl = document.getElementById("mappings-list");

function updateBadges(type) {
  inputBadge.className = "badge";
  outputBadge.className = "badge";
  inputBadge.textContent = "";
  outputBadge.textContent = "";

  if (type === "pc") {
    inputBadge.classList.add("pc");
    inputBadge.textContent = "PC";
    outputBadge.classList.add("mac");
    outputBadge.textContent = "Mac";
  } else if (type === "mac") {
    inputBadge.classList.add("mac");
    inputBadge.textContent = "Mac";
    outputBadge.classList.add("pc");
    outputBadge.textContent = "PC";
  } else {
    inputBadge.classList.add("unknown");
    inputBadge.textContent = "paste a path";
  }
}

function onInput() {
  const val = inputEl.value;
  const firstLine = val.split("\n").find(l => l.trim()) || "";
  const type = detectType(firstLine);
  updateBadges(type);

  if (!val.trim()) {
    outputEl.value = "";
    return;
  }

  outputEl.value = convert(val);
}

inputEl.addEventListener("input", onInput);

// Copy
copyBtn.addEventListener("click", () => {
  const text = outputEl.value;
  if (!text) return;
  navigator.clipboard.writeText(text).then(() => {
    copyBtn.textContent = "Copied!";
    copyBtn.classList.add("copied");
    setTimeout(() => {
      copyBtn.textContent = "Copy";
      copyBtn.classList.remove("copied");
    }, 1500);
  });
});

// Mappings panel
toggleBtn.addEventListener("click", () => {
  toggleBtn.classList.toggle("open");
  panel.classList.toggle("open");
});

// HTML escape utility
const escapeHtml = (() => {
  const map = { '&': '&amp;', '"': '&quot;', '<': '&lt;', '>': '&gt;' };
  return str => str.replace(/[&"<>]/g, m => map[m]);
})();

function renderMappings() {
  listEl.innerHTML = mappings.map((m, i) => `
    <div class="mapping-row">
      <input class="vol-input" value="${escapeHtml(m.vol)}" placeholder="VOLUME_NAME" data-i="${i}" data-field="vol">
      <span class="eq">=</span>
      <input class="letter-input" value="${escapeHtml(m.letter)}" maxlength="1" placeholder="X" data-i="${i}" data-field="letter">
      <button class="mapping-remove" data-i="${i}" title="Remove">&times;</button>
    </div>
  `).join('');
}

// Use event delegation for mapping inputs and buttons
listEl.addEventListener("input", (e) => {
  if (!e.target.matches("input")) return;
  const idx = parseInt(e.target.dataset.i);
  const field = e.target.dataset.field;
  let val = e.target.value;
  if (field === "letter") {
    val = val.toUpperCase().replace(/[^A-Z]/g, "");
    e.target.value = val;
  }
  mappings[idx][field] = val;
  saveMappings(mappings);
  onInput();
});

listEl.addEventListener("click", (e) => {
  if (!e.target.matches(".mapping-remove")) return;
  const idx = parseInt(e.target.dataset.i);
  mappings.splice(idx, 1);
  saveMappings(mappings);
  renderMappings();
  onInput();
});

document.getElementById("add-mapping").addEventListener("click", () => {
  mappings.push({ vol: "", letter: "" });
  saveMappings(mappings);
  renderMappings();
  // Focus the new volume input
  const inputs = listEl.querySelectorAll(".vol-input");
  if (inputs.length) inputs[inputs.length - 1].focus();
});

document.getElementById("reset-mappings").addEventListener("click", () => {
  mappings = DEFAULT_MAPPINGS.map(m => ({ ...m }));
  saveMappings(mappings);
  renderMappings();
  onInput();
});

renderMappings();

// --- Theme Picker ---

const THEME_KEY = "pcpath_theme";
const themeToggle = document.getElementById("theme-toggle");
const themeDropdown = document.getElementById("theme-dropdown");
const themeSwatch = document.getElementById("theme-swatch");
const themeLabel = document.getElementById("theme-label");
const hexInput = document.getElementById("hex-input");
const hexApply = document.getElementById("hex-apply");
const fontHexInput = document.getElementById("font-hex-input");
const fontHexApply = document.getElementById("font-hex-apply");
const fontHexAuto = document.getElementById("font-hex-auto");

let currentBg = "#0f0f0f";
let currentFont = "#e0e0e0";
let isCustomFont = false;

function isLightColor(hex) {
  hex = hex.replace("#", "");
  if (hex.length === 3) hex = hex[0].repeat(2) + hex[1].repeat(2) + hex[2].repeat(2);
  const r = parseInt(hex.slice(0, 2), 16);
  const g = parseInt(hex.slice(2, 4), 16);
  const b = parseInt(hex.slice(4, 6), 16);
  // Using relative luminance formula
  return (r * 299 + g * 587 + b * 114) / 1000 > 140;
}

function autoFontColor(bgHex) {
  return isLightColor(bgHex) ? "#222222" : "#e0e0e0";
}

function applyTheme(bgColor, fontColor, customFont) {
  currentBg = bgColor;
  currentFont = fontColor;
  isCustomFont = customFont;

  document.body.style.background = bgColor;
  document.body.style.setProperty("--font-color", fontColor);
  themeSwatch.style.background = bgColor;

  if (isLightColor(bgColor)) {
    document.body.classList.add("light-theme");
  } else {
    document.body.classList.remove("light-theme");
  }

  localStorage.setItem(THEME_KEY, JSON.stringify({ bgColor, fontColor, isCustomFont: customFont }));
}

function loadTheme() {
  try {
    const saved = localStorage.getItem(THEME_KEY);
    if (saved) {
      const data = JSON.parse(saved);
      if (data.bgColor) {
        applyTheme(data.bgColor, data.fontColor || autoFontColor(data.bgColor), data.isCustomFont || false);
        return;
      }
      // Handle old format
      if (data.color) {
        const font = autoFontColor(data.color);
        applyTheme(data.color, font, false);
        return;
      }
    }
  } catch {}
  // Default
  applyTheme("#0f0f0f", "#e0e0e0", false);
}

// Preset buttons using event delegation
themeDropdown.addEventListener("click", (e) => {
  const option = e.target.closest(".theme-option");
  if (option) {
    const { color: bg, font } = option.dataset;
    applyTheme(bg, font, false);
    fontHexInput.value = "";
    hexInput.value = "";
    themeDropdown.classList.remove("open");
  }
});

// Helper to validate and normalize hex input
function validateHex(input) {
  let val = input.value.trim().replace(/^#/, "");
  if (/^[0-9a-fA-F]{3}$/.test(val) || /^[0-9a-fA-F]{6}$/.test(val)) {
    input.classList.remove("invalid");
    return "#" + val;
  }
  input.classList.add("invalid");
  setTimeout(() => input.classList.remove("invalid"), 300);
  return null;
}

// Custom BG hex
function applyBgHex() {
  const hex = validateHex(hexInput);
  if (hex) {
    const font = isCustomFont ? currentFont : autoFontColor(hex);
    applyTheme(hex, font, isCustomFont);
    hexInput.value = "";
    themeDropdown.classList.remove("open");
  }
}

hexApply.addEventListener("click", applyBgHex);
hexInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter") applyBgHex();
});

// Custom font hex
function applyFontHex() {
  const hex = validateHex(fontHexInput);
  if (hex) {
    applyTheme(currentBg, hex, true);
    fontHexInput.value = "";
    themeDropdown.classList.remove("open");
  }
}

fontHexApply.addEventListener("click", applyFontHex);
fontHexInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter") applyFontHex();
});

// Auto reset font color
fontHexAuto.addEventListener("click", () => {
  const font = autoFontColor(currentBg);
  fontHexInput.value = "";
  applyTheme(currentBg, font, false);
});

// Toggle dropdown
themeToggle.addEventListener("click", (e) => {
  e.stopPropagation();
  themeDropdown.classList.toggle("open");
});

// Close on outside click
document.addEventListener("click", (e) => {
  if (!e.target.closest(".theme-picker")) {
    themeDropdown.classList.remove("open");
  }
});

loadTheme();
</script>
</body>
</html>
